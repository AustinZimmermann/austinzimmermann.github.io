<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Wars: Episode V - The Empire Strikes Back (1980) | Torrent Details</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0b; color: #e5e7eb; }
        .star-wars-gradient {
            background: linear-gradient(to bottom, rgba(10, 10, 11, 0.4), rgba(10, 10, 11, 1)), 
                        url('https://images.unsplash.com/photo-1472457897821-70d3819a0e24?auto=format&fit=crop&q=80&w=2000');
            background-size: cover;
            background-position: center;
        }
        .glass-panel {
            background: rgba(23, 23, 23, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .torrent-box {
            border-left: 4px solid #3b82f6;
        }
        .comment-item {
            transition: all 0.2s ease;
        }
        .comment-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Movie",
      "name": "Star Wars: Episode V - The Empire Strikes Back",
      "image": "https://m.media-amazon.com/images/M/MV5BYmU1ZTMwMzgtM2UxMi00MmE3LThjZGUtYzhjZGU3NzJlNzU1XkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_.jpg",
      "description": "After the Rebels are brutally overpowered by the Empire on the ice planet Hoth, Luke Skywalker begins Jedi training with Yoda, while his friends are pursued by Darth Vader and a bounty hunter named Boba Fett through the galaxy.",
      "director": {
        "@type": "Person",
        "name": "Irvin Kershner"
      },
      "datePublished": "1980-05-21",
      "genre": ["Action", "Adventure", "Fantasy"],
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "8.7",
        "bestRating": "10",
        "ratingCount": "1300000"
      }
    }
    </script>
</head>
<body class="min-h-screen">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 glass-panel px-4 py-3 border-b border-white/10">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 p-1.5 rounded-lg">
                    <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                </div>
                <span class="text-xl font-bold tracking-tight text-white">REFLUX<span class="text-blue-500">LABS</span></span>
            </div>
            <div class="hidden md:flex items-center gap-8 text-sm font-medium text-gray-400">
                <a href="#" class="hover:text-white transition">Movies</a>
                <a href="#" class="hover:text-white transition">TV Shows</a>
                <a href="#" class="hover:text-white transition">Browse</a>
                <a href="#" class="hover:text-white transition">Top Rated</a>
            </div>
            <div class="flex items-center gap-4">
                <button class="p-2 hover:bg-white/10 rounded-full transition"><i data-lucide="search" class="w-5 h-5"></i></button>
                <div id="user-status" class="text-xs text-gray-400 font-mono hidden md:block">Connecting...</div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative star-wars-gradient pt-24 pb-12 px-4">
        <div class="max-w-6xl mx-auto grid md:grid-cols-[300px_1fr] gap-8 items-end">
            <div class="relative group">
                <img src="https://m.media-amazon.com/images/M/MV5BYmU1ZTMwMzgtM2UxMi00MmE3LThjZGUtYzhjZGU3NzJlNzU1XkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_.jpg" 
                     alt="The Empire Strikes Back Poster" 
                     class="rounded-xl shadow-2xl w-full border border-white/20"
                     onerror="this.src='https://placehold.co/300x450/111/fff?text=No+Poster'">
                <div class="absolute inset-0 bg-blue-600/20 opacity-0 group-hover:opacity-100 transition rounded-xl pointer-events-none"></div>
            </div>
            <div class="space-y-4 pb-4">
                <div class="flex flex-wrap gap-2 text-xs font-bold uppercase tracking-widest">
                    <span class="bg-blue-600 text-white px-2 py-0.5 rounded">720p WEB-DL</span>
                    <span class="bg-gray-800 text-gray-300 px-2 py-0.5 rounded">DDP5.1</span>
                    <span class="bg-gray-800 text-gray-300 px-2 py-0.5 rounded">H.264</span>
                </div>
                <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight">
                    Star Wars: Episode V<br>
                    <span class="text-blue-400">The Empire Strikes Back</span>
                </h1>
                <div class="flex items-center gap-6 text-sm text-gray-300">
                    <span class="flex items-center gap-1"><i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400"></i> 8.7/10</span>
                    <span>1980</span>
                    <span>2h 4m</span>
                    <span class="border border-gray-600 px-1 rounded text-[10px]">PG</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-12 grid grid-cols-1 lg:grid-cols-[1fr_350px] gap-8">
        <!-- Left Column -->
        <div class="space-y-8">
            <!-- File Info Box -->
            <section class="glass-panel rounded-2xl p-6 torrent-box">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <div>
                        <h2 class="text-lg font-bold text-white mb-1">Release Information</h2>
                        <p class="text-sm text-gray-400 font-mono break-all">Star.Wars.The.Empire.Strikes.Bsck.Episode.V.1980.720p.DSNP.WEB-DL.DDP5.1.H.264-REFLUX.mkv</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyFilename()" class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition">
                            <i data-lucide="copy" class="w-4 h-4"></i> Copy
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 py-4 border-t border-white/5">
                    <div>
                        <span class="block text-[10px] text-gray-500 uppercase tracking-tighter">Size</span>
                        <span class="text-sm font-semibold">2.41 GB</span>
                    </div>
                    <div>
                        <span class="block text-[10px] text-gray-500 uppercase tracking-tighter">Seeders</span>
                        <span class="text-sm font-semibold text-green-400">1,248</span>
                    </div>
                    <div>
                        <span class="block text-[10px] text-gray-500 uppercase tracking-tighter">Leechers</span>
                        <span class="text-sm font-semibold text-red-400">84</span>
                    </div>
                    <div>
                        <span class="block text-[10px] text-gray-500 uppercase tracking-tighter">Uploaded</span>
                        <span class="text-sm font-semibold">2 days ago</span>
                    </div>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button id="main-download" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-600/20 transition flex items-center justify-center gap-3">
                        <i data-lucide="download" class="w-5 h-5"></i> Download Torrent
                    </button>
                    <button class="bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 px-8 rounded-xl transition flex items-center justify-center gap-3">
                        <i data-lucide="magnet" class="w-5 h-5 text-red-400"></i> Magnet Link
                    </button>
                </div>
            </section>

            <!-- Plot Summary -->
            <section class="space-y-4">
                <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                    <i data-lucide="align-left" class="w-6 h-6 text-blue-500"></i> Synopsis
                </h3>
                <p class="text-gray-300 leading-relaxed text-lg" id="synopsis-content">
                    Loading cinematic summary...
                </p>
            </section>

            <!-- Media Specs -->
            <section class="space-y-4">
                <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                    <i data-lucide="file-text" class="w-6 h-6 text-blue-500"></i> Media Info
                </h3>
                <div class="bg-black/40 rounded-xl p-6 font-mono text-sm text-gray-400 border border-white/5 space-y-1">
                    <p><span class="text-blue-400">Video:</span> H.264 | 1280x544 | 23.976 fps | 2450 kbps</p>
                    <p><span class="text-blue-400">Audio:</span> English | E-AC3 | 6 Channels | 256 kbps</p>
                    <p><span class="text-blue-400">Source:</span> Disney+ (DSNP)</p>
                    <p><span class="text-blue-400">Subtitles:</span> English, French, Spanish, Portuguese, German, Italian</p>
                </div>
            </section>

            <!-- Comments Section -->
            <section id="comments-section" class="space-y-6 pt-8 border-t border-white/10">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                        <i data-lucide="message-square" class="w-6 h-6 text-blue-500"></i> Community
                    </h3>
                    <span id="comment-count" class="text-xs font-mono bg-white/10 px-2 py-1 rounded">0 Comments</span>
                </div>

                <div id="comment-form-container" class="glass-panel p-4 rounded-xl space-y-3">
                    <textarea id="comment-input" rows="3" placeholder="Join the discussion..." 
                              class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-white transition"></textarea>
                    <div class="flex justify-end">
                        <button id="post-comment" class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-6 py-2 rounded-lg transition disabled:opacity-50">
                            Post Comment
                        </button>
                    </div>
                </div>

                <div id="comments-list" class="space-y-4">
                    <!-- Dynamic Comments -->
                    <div class="flex justify-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Right Column -->
        <aside class="space-y-8">
            <!-- Cast -->
            <section class="glass-panel rounded-2xl p-6">
                <h4 class="font-bold text-white mb-6 uppercase tracking-widest text-xs flex items-center gap-2">
                    <i data-lucide="users" class="w-4 h-4 text-blue-500"></i> Top Cast
                </h4>
                <div class="space-y-4">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-gray-800 overflow-hidden">
                            <img src="https://placehold.co/100/111/fff?text=MH" alt="Mark Hamill">
                        </div>
                        <div>
                            <p class="text-sm font-bold text-white">Mark Hamill</p>
                            <p class="text-[10px] text-gray-500">Luke Skywalker</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-gray-800 overflow-hidden">
                            <img src="https://placehold.co/100/111/fff?text=HF" alt="Harrison Ford">
                        </div>
                        <div>
                            <p class="text-sm font-bold text-white">Harrison Ford</p>
                            <p class="text-[10px] text-gray-500">Han Solo</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-gray-800 overflow-hidden">
                            <img src="https://placehold.co/100/111/fff?text=CF" alt="Carrie Fisher">
                        </div>
                        <div>
                            <p class="text-sm font-bold text-white">Carrie Fisher</p>
                            <p class="text-[10px] text-gray-500">Princess Leia</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Technical Table -->
            <section class="glass-panel rounded-2xl p-6">
                <h4 class="font-bold text-white mb-6 uppercase tracking-widest text-xs flex items-center gap-2">
                    <i data-lucide="info" class="w-4 h-4 text-blue-500"></i> Technical Data
                </h4>
                <div class="space-y-3 text-xs">
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-gray-500">Uploader</span>
                        <span class="text-blue-400 font-bold">REFLUX</span>
                    </div>
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-gray-500">Bitrate</span>
                        <span>~2.5 Mbps</span>
                    </div>
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-gray-500">Language</span>
                        <span>en-US</span>
                    </div>
                    <div class="flex justify-between border-b border-white/5 pb-2">
                        <span class="text-gray-500">Hash</span>
                        <span class="font-mono">8F32B...A12</span>
                    </div>
                </div>
            </section>
        </aside>
    </main>

    <footer class="mt-24 border-t border-white/10 py-12 text-center text-gray-500 text-sm">
        <p>&copy; 2026 REFLUX Torrent Indexer. For educational purposes only.</p>
        <div class="flex justify-center gap-6 mt-4">
            <a href="#" class="hover:text-white transition">Privacy</a>
            <a href="#" class="hover:text-white transition">DMCA</a>
            <a href="#" class="hover:text-white transition">Contact</a>
        </div>
    </footer>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, query, orderBy, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('debug');

        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'sw-v-demo';
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;

        // Initialize UI
        lucide.createIcons();

        // 1. Authentication
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth error:", error);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-status').innerText = `ID: ${user.uid.substring(0, 8)}...`;
                loadComments();
            }
        });

        // 2. Comments Logic
        const loadComments = () => {
            const commentsRef = collection(db, `artifacts/${appId}/public/data/comments`);
            const q = query(commentsRef); // Note: Simplified query to avoid index errors per instructions

            onSnapshot(q, (snapshot) => {
                const list = document.getElementById('comments-list');
                const countBadge = document.getElementById('comment-count');
                
                let comments = [];
                snapshot.forEach(doc => comments.push({id: doc.id, ...doc.data()}));
                
                // Sort in memory instead of orderBy in Firestore
                comments.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                countBadge.innerText = `${comments.length} Comments`;

                if (comments.length === 0) {
                    list.innerHTML = `<div class="text-center py-8 text-gray-500">No comments yet. Be the first!</div>`;
                    return;
                }

                list.innerHTML = comments.map(c => `
                    <div class="comment-item glass-panel p-4 rounded-xl border border-white/5">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-[10px] text-blue-400 font-bold uppercase">
                                    ${(c.userName || 'U').charAt(0)}
                                </div>
                                <span class="text-sm font-bold text-gray-200">${c.userName || 'Anonymous'}</span>
                            </div>
                            <span class="text-[10px] text-gray-500">${c.timestamp ? new Date(c.timestamp.seconds * 1000).toLocaleDateString() : 'Just now'}</span>
                        </div>
                        <p class="text-sm text-gray-400 leading-relaxed">${c.text}</p>
                    </div>
                `).join('');
            });
        };

        document.getElementById('post-comment').addEventListener('click', async () => {
            const input = document.getElementById('comment-input');
            const text = input.value.trim();
            if (!text || !currentUser) return;

            const btn = document.getElementById('post-comment');
            btn.disabled = true;
            btn.innerText = "Posting...";

            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/comments`), {
                    userId: currentUser.uid,
                    userName: `User_${currentUser.uid.substring(0, 4)}`,
                    text: text,
                    timestamp: serverTimestamp()
                });
                input.value = "";
            } catch (e) {
                console.error("Error adding document: ", e);
            } finally {
                btn.disabled = false;
                btn.innerText = "Post Comment";
            }
        });

        // 3. API Fetch for Cinematic Summary
        const fetchSummary = async () => {
            const apiKey = ""; // Canvas handles this
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const prompt = "Write a compelling, cinematic 2-3 sentence summary of Star Wars: The Empire Strikes Back focusing on its legacy and the high stakes for the Rebels.";
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "You are a professional film critic and copywriter." }] }
                    })
                });
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    document.getElementById('synopsis-content').innerText = text;
                }
            } catch (err) {
                document.getElementById('synopsis-content').innerText = "The Rebellion faces its darkest hour. After the loss of their base on Hoth, Luke Skywalker seeks training with Master Yoda while the Empire tightens its grip on the galaxy. A cinematic masterpiece that redefined science fiction for generations.";
            }
        };

        // Initialize
        initAuth();
        fetchSummary();

        // Utilities
        window.copyFilename = () => {
            const filename = "Star.Wars.The.Empire.Strikes.Bsck.Episode.V.1980.720p.DSNP.WEB-DL.DDP5.1.H.264-REFLUX.mkv";
            const el = document.createElement('textarea');
            el.value = filename;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            // Visual Feedback
            const btn = event.currentTarget;
            const originalHtml = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Copied!`;
            lucide.createIcons();
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                lucide.createIcons();
            }, 2000);
        };

        document.getElementById('main-download').addEventListener('click', () => {
            const btn = document.getElementById('main-download');
            btn.innerHTML = `<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div> Requesting Peers...`;
            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i> Starting Download...`;
                lucide.createIcons();
                setTimeout(() => {
                    btn.innerHTML = `<i data-lucide="download" class="w-5 h-5"></i> Download Torrent`;
                    lucide.createIcons();
                }, 3000);
            }, 1500);
        });

    </script>
</body>
</html>