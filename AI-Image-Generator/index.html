<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visionary AI - Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: Helvetica, sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-border {
            position: relative;
            border-radius: 0.75rem;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            padding: 1px;
        }

        .gradient-border > div {
            background: #1e293b;
            border-radius: 0.7rem;
        }

        .loading-shimmer {
            background: linear-gradient(
                90deg,
                rgba(30, 41, 59, 1) 25%,
                rgba(51, 65, 85, 1) 50%,
                rgba(30, 41, 59, 1) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .image-container {
            aspect-ratio: 1 / 1;
            transition: aspect-ratio 0.3s ease;
        }

        .image-container.landscape { aspect-ratio: 16 / 9; }
        .image-container.portrait { aspect-ratio: 9 / 16; }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold tracking-tight mb-2 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Visionary AI
            </h1>
            <p class="text-slate-400">Turn your imagination into high-resolution reality.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Sidebar Controls -->
            <aside class="lg:col-span-4 space-y-6">
                <div class="glass-panel p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-sliders text-blue-400"></i> Configuration
                    </h2>

                    <!-- Prompt Area -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Prompt</label>
                            <textarea id="promptInput" rows="4" 
                                class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm resize-none"
                                placeholder="A futuristic city with neon lights and flying cars, digital art style..."></textarea>
                        </div>

                        <!-- Style Selection -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Art Style</label>
                            <select id="styleSelect" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm appearance-none">
                                <option value="none">Default (Photorealistic)</option>
                                <option value="cinematic">Cinematic</option>
                                <option value="anime">Anime / Manga</option>
                                <option value="digital-art">Digital Art</option>
                                <option value="cyberpunk">Cyberpunk</option>
                                <option value="oil-painting">Oil Painting</option>
                                <option value="watercolor">Watercolor</option>
                                <option value="pixel-art">Pixel Art</option>
                            </select>
                        </div>

                        <!-- Aspect Ratio -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Aspect Ratio</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setRatio('1:1')" class="ratio-btn border border-blue-500 bg-blue-500/20 text-blue-400 py-2 rounded-lg text-xs font-bold" data-ratio="1:1">1:1</button>
                                <button onclick="setRatio('16:9')" class="ratio-btn border border-slate-700 hover:border-blue-500 py-2 rounded-lg text-xs font-bold" data-ratio="16:9">16:9</button>
                                <button onclick="setRatio('9:16')" class="ratio-btn border border-slate-700 hover:border-blue-500 py-2 rounded-lg text-xs font-bold" data-ratio="9:16">9:16</button>
                            </div>
                        </div>

                        <button id="generateBtn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Generate Image
                        </button>
                    </div>
                </div>

                <!-- History / Tips -->
                <div class="glass-panel p-6 rounded-2xl hidden md:block">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Pro Tips</h3>
                    <ul class="text-xs text-slate-500 space-y-2">
                        <li>• Use descriptive adjectives (e.g., "ethereal", "hyper-detailed").</li>
                        <li>• Mention lighting (e.g., "golden hour", "volumetric lighting").</li>
                        <li>• The AI works best with English prompts.</li>
                    </ul>
                </div>
            </aside>

            <!-- Main Display Area -->
            <main class="lg:col-span-8 space-y-6">
                <div id="displayArea" class="glass-panel p-4 md:p-8 rounded-2xl min-h-[500px] flex flex-col items-center justify-center relative overflow-hidden">
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="text-center space-y-4">
                        <div class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-regular fa-image text-3xl text-slate-600"></i>
                        </div>
                        <h3 class="text-xl font-medium text-slate-400">Ready to visualize?</h3>
                        <p class="text-sm text-slate-500 max-w-xs mx-auto">Enter a prompt on the left and hit generate to see the magic happen.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="hidden w-full h-full flex flex-col items-center justify-center space-y-6">
                        <div id="loaderPlaceholder" class="w-full max-w-lg loading-shimmer rounded-xl image-container"></div>
                        <div class="flex flex-col items-center">
                            <div class="flex space-x-2 mb-4">
                                <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.3s"></div>
                            </div>
                            <p class="text-blue-400 font-medium animate-pulse">Consulting the creative spirits...</p>
                        </div>
                    </div>

                    <!-- Result State -->
                    <div id="resultState" class="hidden w-full flex flex-col items-center space-y-6">
                        <div class="relative group">
                            <img id="generatedImage" src="" alt="AI Generated Content" class="rounded-xl shadow-2xl max-w-full h-auto border border-white/10">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-xl pointer-events-none">
                                <p class="text-white text-sm font-medium">Generation Complete</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-4 w-full max-w-md">
                            <button id="downloadBtn" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors border border-slate-700">
                                <i class="fa-solid fa-download"></i> Download
                            </button>
                            <button id="copyBtn" class="bg-slate-800 hover:bg-slate-700 text-white py-3 px-6 rounded-xl transition-colors border border-slate-700">
                                <i class="fa-solid fa-copy"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Error State -->
                    <div id="errorState" class="hidden text-center space-y-4">
                        <div class="w-16 h-16 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-triangle-exclamation text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-red-400">Oops! Something went wrong</h3>
                        <p id="errorMessage" class="text-sm text-slate-400 max-w-xs mx-auto">We couldn't generate the image. Please check your prompt and try again.</p>
                        <button onclick="resetApp()" class="text-blue-400 text-sm hover:underline">Try again</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl transform translate-y-20 transition-transform duration-300 z-50 flex items-center gap-3 border border-slate-700">
        <i class="fa-solid fa-check-circle text-green-400"></i>
        <span id="toastMessage">Action successful!</span>
    </div>

    <script>
        const apiKey = ""; // Environment will provide this
        let currentRatio = "1:1";

        // DOM Elements
        const promptInput = document.getElementById('promptInput');
        const styleSelect = document.getElementById('styleSelect');
        const generateBtn = document.getElementById('generateBtn');
        const emptyState = document.getElementById('emptyState');
        const loadingState = document.getElementById('loadingState');
        const resultState = document.getElementById('resultState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const generatedImage = document.getElementById('generatedImage');
        const downloadBtn = document.getElementById('downloadBtn');
        const copyBtn = document.getElementById('copyBtn');
        const loaderPlaceholder = document.getElementById('loaderPlaceholder');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // Functions
        function setRatio(ratio) {
            currentRatio = ratio;
            document.querySelectorAll('.ratio-btn').forEach(btn => {
                if (btn.dataset.ratio === ratio) {
                    btn.classList.add('border-blue-500', 'bg-blue-500/20', 'text-blue-400');
                    btn.classList.remove('border-slate-700');
                } else {
                    btn.classList.remove('border-blue-500', 'bg-blue-500/20', 'text-blue-400');
                    btn.classList.add('border-slate-700');
                }
            });

            // Update loader placeholder shape
            loaderPlaceholder.classList.remove('landscape', 'portrait');
            if (ratio === '16:9') loaderPlaceholder.classList.add('landscape');
            if (ratio === '9:16') loaderPlaceholder.classList.add('portrait');
        }

        function showToast(message) {
            toastMessage.textContent = message;
            toast.style.transform = "translate(-50%, 0)";
            setTimeout(() => {
                toast.style.transform = "translate(-50%, 5rem)";
            }, 3000);
        }

        function resetApp() {
            emptyState.classList.remove('hidden');
            loadingState.classList.add('hidden');
            resultState.classList.add('hidden');
            errorState.classList.add('hidden');
        }

        async function generateImage() {
            const prompt = promptInput.value.trim();
            if (!prompt) {
                showToast("Please enter a prompt!");
                promptInput.focus();
                return;
            }

            const style = styleSelect.value;
            let fullPrompt = prompt;
            if (style !== 'none') {
                fullPrompt = `${prompt}, ${style} style, high quality, masterpiece`;
            }

            // UI Transitions
            emptyState.classList.add('hidden');
            resultState.classList.add('hidden');
            errorState.classList.add('hidden');
            loadingState.classList.remove('hidden');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';

            const payload = {
                instances: [{ prompt: fullPrompt }],
                parameters: { sampleCount: 1 }
            };

            const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

            // Exponential Backoff implementation
            let retryCount = 0;
            const maxRetries = 5;

            async function attemptFetch() {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to generate');
                    }

                    const data = await response.json();
                    if (data.predictions && data.predictions[0].bytesBase64Encoded) {
                        return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                    } else {
                        throw new Error('No image returned in response.');
                    }
                } catch (err) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount - 1) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return attemptFetch();
                    }
                    throw err;
                }
            }

            try {
                const imageUrl = await attemptFetch();
                generatedImage.src = imageUrl;
                
                loadingState.classList.add('hidden');
                resultState.classList.remove('hidden');
                showToast("Image generated successfully!");
            } catch (error) {
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                errorMessage.textContent = error.message;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Generate Image';
            }
        }

        // Event Listeners
        generateBtn.addEventListener('click', generateImage);

        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = generatedImage.src;
            link.download = `visionary-ai-${Date.now()}.png`;
            link.click();
            showToast("Downloading image...");
        });

        copyBtn.addEventListener('click', () => {
            // Using a simple canvas to copy the image data
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.src = generatedImage.src;
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                canvas.toBlob(blob => {
                    const item = new ClipboardItem({ "image/png": blob });
                    navigator.clipboard.write([item]).then(() => {
                        showToast("Copied to clipboard!");
                    }).catch(() => {
                        showToast("Failed to copy image.");
                    });
                });
            };
        });

        // Initialize ratio
        setRatio('1:1');
    </script>
</body>
</html>
